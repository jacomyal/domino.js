/* domino.js - A cascading controller for fast interactive Web interfaces prototyping. - Version: 1.3.1 - Author:  Alexis Jacomy, Linkfluence - License: MIT */
!function(a){"use strict";function b(){return!!n.xhr}function c(){n.strict?d.apply(this,arguments):e.apply(this,arguments)}function d(){throw new Error(Array.prototype.join.call(arguments," "))}function e(){n.verbose&&f.apply(this,arguments)}function f(){for(var a=[],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);n.displayTime&&a.unshift(("00000000"+((new Date).getTime()-h)).substr(-8)),console&&console.log instanceof Function&&console.log.apply(console,a)}var g=/^[a-zA-Z_$-][a-zA-Z_$0-9-]*$/,h=new Date,i={},j=this;if(j.domino)throw new Error("domino already exists");var k=function(){function b(a){var b=a||{},c={getEvents:z,getLabel:y,expand:A,warn:G,log:I,die:H,get:u};return b.full?(c.help=D,c.kill=E,c.update=r,c.request=w,c.settings=F,c.modules=p,c.addModule=m,c.killModule=q,c.getEvent=function(){L.getEvent.apply(L,arguments)},c.addEventListener=function(){L.addEventListener.apply(L,arguments)},c.removeEventListener=function(){L.removeEventListener.apply(L,arguments)},c.configuration=C,c.dispatchEvent=function(a,b){var c,d,e=M.array(a),f=[];for(c=0,d=e.length;d>c;c++)f.push(L.getEvent(e[c],b));return t({events:f}),this}):(b.request&&(Object.defineProperty(c,"_services",{value:[]}),c.request=function(a,b){var c,d;if(N.check("string",a)){d={service:a};for(c in b||{})d[c]=b[c];this._services.push(d)}else if(N.check("object",a))this._services.push(a);else if(N.check("array",a)){if(d={services:a},N.check("object",b))for(c in b)d[c]=b[c];this._services.push(d)}return this}),b.dispatchEvent&&(Object.defineProperty(c,"_events",{value:[]}),c.dispatchEvent=function(a,b){var c,d,e=M.array(a);for(c=0,d=e.length;d>c;c++)this._events.push(L.getEvent(e[c],b));return this}),b.update&&(Object.defineProperty(c,"_properties",{value:[]}),c.update=function(a,b){if("object"==typeof a)for(var c in a)this._properties.push({property:c,value:a[c]});else"string"==typeof a&&arguments.length>1&&this._properties.push({property:a,value:b});return this})),c}function c(b){b.request!==a&&(b.request=function(){return H("This method is no longer available."),this}),b.dispatchEvent!==a&&(b.dispatchEvent=function(){return H("This method is no longer available."),this}),b.update!==a&&(b.update=function(){return H("This method is no longer available."),this})}function e(b,c){var d,e,f=c||{};b===a&&H("Property name not specified"),"string"!==N.get(b)&&H("The property name must be a string"),V[b]!==a&&H('Property "'+b+'" already exists'),nb[b]!==a&&H('"'+b+'" can not be used to name a property'),b.match(g)||H("Property name not valid ("+g+")"),W[b]={};for(e in f)W[b][e]=f[e];if(Q[b]=f.label||b,f.description&&(_.properties[b]=f.description),f.type!==a&&(N.isValid(f.type)?P[b]=f.type:G('Property "'+b+'": Type not valid')),f.setter!==a&&("function"!==N.get(f.setter)?G('Property "'+b+'": Setter is not a function'):(T[b]=f.setter,Y[b]=!0)),T[b]=T[b]||function(a){return N.deepScalar(P[b])&&N.compare(a,V[b],P[b])?!1:(P[b]&&!N.check(P[b],a)?G('Property "'+b+'": Wrong type error'):V[b]=a,!0)},f.getter!==a&&("function"!==N.get(f.getter)?G('Property "'+b+'": Getter is not a function'):(S[b]=f.getter,X[b]=!0)),S[b]=S[b]||function(){return V[b]},(f.value!==a||P[b])&&(f.value!==a?v(b,f.value):I('Property "'+b+'": '+"Initial value is missing")),f.triggers!==a){!N.check("array|string",f.triggers)&&G('Property "'+b+'": '+'Events ("triggers") must be specified in an array or '+"separated by spaces in a string"),R[b]=M.array(f.triggers);for(d in R[b]||[])bb[R[b][d]]=bb[R[b][d]]||[],bb[R[b][d]].push(b)}return f.dispatch!==a&&(N.check("array|string",f.dispatch)?cb[b]=M.array(f.dispatch):G('Property "'+b+'": '+'Events ("dispatch") must be specified in an array or '+"separated by spaces in a string")),L}function h(b){var c,d,e=b||{};e.triggers===a&&H("A hack requires at least one trigger to be bound"),e.description&&hb.push(e.description),c=M.array(e.triggers);for(d in c)ib[c[d]]=ib[c[d]]||[],gb[c[d]]=gb[c[d]]||[],fb[c[d]]=fb[c[d]]||[],e.description&&(ib[c[d]]=ib[c[d]].concat(e.description)),e.method&&fb[c[d]].push(e.method),e.dispatch&&(gb[c[d]]=gb[c[d]].concat(M.array(e.dispatch)));c=M.array(e.dispatch);for(d in c)jb[c[d]]=jb[c[d]]||[],e.description&&(jb[c[d]]=jb[c[d]].concat(e.description));return L}function j(d,e){var f=e||{};return"string"!==N.get(d)&&H("The service id is not specified."),N.check("function|string",f.url)||H("The service URL is not valid."),kb[d]!==a&&H('The service "'+d+'" already exists.'),f.description&&(_.services[d]=f.description),kb[d]=function(e){I('Calling service "'+d+'".');var g,h,i,j,k,l=e||{},m=l.shortcuts||{},n={contentType:l.contentType||f.contentType,dataType:l.dataType||f.dataType,type:(l.type||f.type||"GET").toString().toUpperCase(),data:l.data!==a?l.data:"function"===N.get(f.data)?f.data.call(b(),l):f.data,url:"function"===N.get(f.url)?f.url.call(b(),l):f.url,error:function(a,b){L.dispatchEvent("domino.ajaxFailed");var c=l.error||f.error;I('Loading service "'+d+'" '+'failed with message "'+a+'" '+"and status "+b.status+"."),"function"===N.get(c)&&x(c,{parameters:[a,b,l],loop:l.loop||t,scope:{request:!0,dispatchEvent:!0,update:!0}})}},o=F("shortcutPrefix"),p=new RegExp(o+"(\\w+)","g"),q=new RegExp("^"+o+"(\\w+)$"),r=null;for("string"!==N.get(n.url)&&H('The URL is no more a string (typed "'+N.get(n.url)+'")');(k=n.url.match(p))&&n.url!==r;){r=n.url;for(g in k)h=A(k[g].match(q)[1],m),n.url=n.url.replace(new RegExp(k[g],"g"),h)}if(j=!0,"string"===N.get(n.data)&&n.data.match(q)&&(n.data=A(n.data.match(q)[1],m)),"object"===N.get(n.data))for(;j;){j=!1;for(i in n.data)"string"===N.get(n.data[i])&&n.data[i].match(q)&&(n.data[i]=A(n.data[i].match(q)[1],m),j=!0)}n.success=function(e,g){var h,j,k,o,p,r={},s=[],u=[],v={},w=!1,y=l.path||f.path,z=l.setter||f.setter,B=l.success||f.success,C=l.expect||f.expect||F("expect");if("function"===N.get(C)&&!C.call(b(),e,l,f))return I('"expect" test failed for service "'+d+'".'),n.error.call(this,"Unexpected data received.",g),void 0;if(I('Service "'+d+'" successfull.'),"string"===N.get(z)&&z.match(q)&&(z=A(z.match(q)[1],m)),"string"===N.get(y)&&y.match(q)&&(y=A(y.match(q)[1],m)),p=e,(y||"").match(/^(?:\w+\.)*\w+$/)?o=N.get(y,"string")?y.split("."):a:"string"===N.get(y)&&G('Path "'+y+'" does not match RegExp /^(?:\\w+\\.)*\\w+$/'),o)for(h in o)p=p[o[h]],p!==a||G('Wrong path "'+y+'" for service "'+d+'".');j=M.array(f.events);for(h in j)r[j[h]]=1,w=!0;j=M.array(l.events);for(h in j)r[j[h]]=1,w=!0;if(z&&T[z]&&p!==a&&(v[z]=p,w=!0),"function"===N.get(B)){var D=x(B,{parameters:[e,l],scope:{request:!0,dispatchEvent:!0,update:!0}});j=M.array(D.events);for(i in j)w=!0,r[j[i].type]=j[i];for(i in D.update)v[i]===a?(v[i]=D.update[i],w=!0):G('The key "'+i+'"'+" is nor a method neither a property.");(D.services||[]).length&&(w=!0,s=s.concat(D.services)),c(D)}u=[];for(k in r)u.push(1===r[k]?L.getEvent(k):r[k]);(w||l.loop)&&(l.loop||t)({events:u,update:v,services:s})};var s=l.before||f.before;"function"==typeof s&&"function"===N.get(s)&&(n.beforeSend=function(a){return x(s,{parameters:[l,a],loop:!0,scope:{dispatchEvent:!0,update:!0}}).returned}),l.abort&&lb[d]&&lb[f.id].abort(),lb[f.id]=M.ajax(n)},L}function l(b,c){var d=c||{},e="function"==typeof d?d:d.method,f="object"==typeof d&&"description"in d?d.description:null;return b===a&&H("Shortcut ID not specified."),mb[b]&&H('Shortcut "'+b+'" already exists.'),e===a&&H("Shortcut method not specified."),f&&(_.shortcuts[b]=f),mb[b]=e,L}function m(c,d,e){var f,g,h,i,j=e||{},k={},l={};c===a&&H("Module class not specified."),"function"!==N.get(c)&&H("First parameter must be a function."),"id"in j&&j.id in $&&H('The module with id "'+j.id+'" already exists.'),c.apply(k,(d||[]).concat(b())),g=k.triggers||{};for(i in g.events||{})db[i]=db[i]||[],db[i].push(g.events[i]);for(h in g.properties||{}){for(f in cb[h]||[])eb[h]=eb[h]||[],eb[h].push(g.properties[h]);if(S[h]!==a){var m={};m[h]=u(h),x(g.properties[h],{parameters:[b()]})}}for(i in bb||{})l[i]=1;for(i in fb||{})l[i]=1;for(i in gb||{})l[i]=1;for(i in ib||{})l[i]=1;for(i in l)k.addEventListener(i,s);return k.log="id"in j?M.partial(I,'[module "'+j.id+'"]'):M.partial(I,"[module]"),k.warn="id"in j?M.partial(G,'[module "'+j.id+'"]'):M.partial(G,"[module]"),k.die="id"in j?M.partial(H,'[module "'+j.id+'"]'):M.partial(H,"[module]"),"id"in j&&($[j.id]=k),Z.push(k),k}function p(a){return $[a]}function q(a){var b,c,d,e,f,g,h,i,j={};if(N.check("string",a)&&(a=$[a]),Z.indexOf(a)<0)return L.warn("The module you try to kill is actually not referenced."),a;i=a.triggers||{};for(g in i.events){if(e=db[g],f=i.events[g],e&&e.length)for(b=0,c=e.length;c>b;b++)e[b]===f&&e.splice(b,1);e&&!e.length&&delete db[g]}for(h in i.properties){if(e=eb[h],f=i.properties[h],e&&e.length)for(b=0,c=e.length;c>b;b++)e[b]===f&&e.splice(b,1);e&&!e.length&&delete eb[h]}for(g in bb||{})j[g]=1;for(g in fb||{})j[g]=1;for(g in gb||{})j[g]=1;for(g in ib||{})j[g]=1;for(g in j)a.removeEventListener(g,s);Z.splice(Z.indexOf(a),1);for(d in $)if($[d]===a){delete $[d];break}return a}function r(a,b){var c="object"==typeof a&&1===arguments.length?a||{}:{};return"string"==typeof a&&(c[a]=b),t({update:c}),this}function s(a){t({events:[a],emitter:a.target})}function t(d){var e,f,g,h,i,j,k,l,m,n,o=!1,p=[],q=[],r=[],s=d||{},u={},y={};s.loop=(+s.loop||0)+1,s.loopId=s.loopId||++ab,F("maxDepth")&&s.loop>F("maxDepth")&&H("Loop "+s.loopId+" exceeds maximum depth ("+F("maxDepth")+")");var z=M.array(s.events),A=M.array(s.services),C=s.update||{};if(F("verbose")){if(I("Iteration "+s.loop+" (loop "+s.loopId+")"),z.length){n=[];for(f in z)n.push(z[f].type);I(" -> Events: ",n)}if(A.length){n=[];for(f in A)n.push("string"==typeof A[f]?A[f]:A[f].service);I(" -> Services: ",n)}n=[];for(f in C)n.push(f);n.length&&I(" -> Update: ",n)}for(m in C)if(T[m]===a)G('The property "'+m+'" is not referenced.');else if(l=v(m,C[m])||s.force||B(m,"force")){for(f in eb[m])x(eb[m][f],{parameters:[b(),{property:m,emitter:s.emitter}]});for(f in cb[m]||[])i=cb[m][f],u[i]=L.getEvent(i)}if(A.length)if(F("mergeRequests")){e=[];for(g in A)A[g].services?w(A[g].services,A[g]):e.push(A[g]),e.length&&w(e)}else for(g in A)A[g].services?w(A[g].services,A[g]):w(A[g]);for(f in z){if(j=z[f],k=j.data||{}){e=bb[j.type]||[];for(g in e)k[e[g]]!==a&&(o=!0,y[e[g]]=k[e[g]])}for(h in db[j.type])x(db[j.type][h],{parameters:[b(),j,s.emitter]});for(g in fb[j.type]||[])if(p.indexOf(fb[j.type][g])<0){p.push(fb[j.type][g]);var D=x(fb[j.type][g],{parameters:[j],scope:{request:!0,dispatchEvent:!0,update:!0}});e=M.array(D.events);for(h in e)u[e[h].type]=e[h];for(h in D.update)y[h]===a?(o=!0,y[h]=D.update[h]):G('The property "'+h+'" '+"has already been updated in the current loop.");(D.services||[]).length&&(o=!0,r=r.concat(D.services)),c(D)}for(g in gb[j.type]||[])i=gb[j.type][g],u[i]=L.getEvent(i);if(F("logDescriptions"))for(g in ib[j.type]||[])I("[HACK]",ib[j.type][g])}for(j in u)L.dispatchEvent(j,u[j].data),q.push(u[j]),o=!0;o&&t({events:q,update:y,services:r,emitter:s.emitter,loopId:s.loopId,loop:s.loop})}function u(a){if(S[a]){if(X[a]){for(var b,c=[],d={},e=1,f=arguments.length;f>e;e++)c.push(arguments[e]);return d[a]=V[a],b=x(S[a],{parameters:c,inputValues:d}),B(a,"clone")?M.clone(b.returned):b.returned}return B(a,"clone")?M.clone(S[a]()):S[a]()}G('Property "'+a+'" not referenced.')}function v(a,c){if(T[a]){if(Y[a]){var d,e,f=[],g={};B(a,"clone")&&(c=M.clone(c)),g[a]=u(a);for(var h=1,i=arguments.length;i>h;h++)f.push(arguments[h]);return e=x(T[a],{parameters:f,inputValues:g}),d="boolean"!==N.get(e.returned)||e.returned,d&&(V[a]=e.update[a]),d}return T[a].call(b(),B(a,"clone")?M.clone(c):c)}return G('Property "'+a+'" not referenced.'),!1}function w(b,c){if(N.check("string",b))kb[b]?kb[b](c):G('Service "'+b+'" not referenced.');else if(N.check("object",b))w(b.service,b);else if(N.check("array",b)){c=c||{};var d,e=b.length,f=c.merge!==a?!!c.merge:F("mergeRequests");if(f){var g,h,i=e,j=[],k=function(){var a,b,d,f={update:{},events:[],services:[]};for(b=0;e>b;b++){a=j[b]||{};for(d in a.update||{})f.update[d]=a.update[d];f.events=f.events.concat(a.events||[]),f.services=f.services.concat(a.services||[])}c.success?x(c.success,{parameters:[j],loop:t,scope:{request:!0,dispatchEvent:!0,update:!0}}):t(f)};for(d=0;e>d;d++){if("string"==typeof b[d])g={service:b[d]};else{g={};for(h in b[d])g[h]=b[d][h]}!function(a){g.loop=function(b){j[a]=b,t(b),--i||k()}}(d),w(g)}}else for(d=0,e=b.length;e>d;d++)w(b[d])}return this}function x(c,d){var e,f,g,h={},i=d||{},j=b(i.scope);"function"!==N.get(c)&&H("The first parameter must be a function");for(e in i.inputValues||{})j[e]=i.inputValues[e];g=c.apply(j,i.parameters||[]),f={returned:g,update:{},events:[],services:[]},null==j._events||N.check("array",j._events)?f.events=j._events:G("Events must be stored in an array.");for(e in j)h[e]=j[e];for(e in j._properties)h[j._properties[e].property]=j._properties[e].value;for(e in h)T[e]!==a?f.update[e]=h[e]:nb[e]===a&&G('The key "'+e+'" is not a method nor a property.');for(e in i.inputValues)f.update[e]=j[e];for(e in j._services)f.services[e]=j._services[e];if(i.loop){var k=(f.services||[]).length||(f.events||[]).length;if(!k)for(e in f.update)k=!0;k&&(N.check("function",i.loop)?i.loop:t)(f)}return f}function y(a){return Q[a]}function z(a){return R[a]}function A(c){var d=c,e=(c||"").toString().match(new RegExp("^"+F("shortcutPrefix")+"(\\w+)$"));e&&e.length&&(G("Prefix in expand() calls is deprecated."),d=e[1]);for(var f=1,g=arguments.length;g>f;f++)if((arguments[f]||{})[d]!==a)return arguments[f][d];return"function"===N.get(S[d])?u(d):"function"===N.get(mb[d])?mb[d].call(b()):(G('The shortcut "',d,'" has not been recognized.'),d)}function B(b,c){var d=(W[b]||{})[c];return d!==a?!!d:F(c)}function C(a){return arguments.length?M.clone(K[a]):M.clone(K)}function D(a,b,c){var d,e={},f="[no description is specified]";switch(a){case"properties":if(1===arguments.length){for(d in V)e[d]=_.properties[d]||f;return e}return _.properties[b]||f;case"services":if(1===arguments.length){for(d in kb)e[d]=_.services[d]||f;return e}return _.services[b]||f;case"shortcuts":if(1===arguments.length){for(d in mb)e[d]=_.shortcuts[d]||f;return e}return _.shortcuts[b]||f;case"hacks":if(1===arguments.length)return hb;if(3===arguments.length)return e=[],"trigger"===b?e=ib[c]:"dispatch"===b&&(e=jb[c]),1===e.length?e[0]:e;case"full":return{properties:D("properties"),shortcuts:D("shortcuts"),services:D("services"),hacks:D("hacks")}}}function E(){var a;I('Killing instance "'+ob+'"');for(a in Z)Z[a].removeEventListener();Z=null,P=null,Q=null,R=null,S=null,T=null,U=null,V=null,X=null,Y=null,Z=null,bb=null,cb=null,db=null,eb=null,fb=null,gb=null,kb=null,lb=null,mb=null;for(a in J)delete J[a];i[ob]&&delete i[ob]}function F(b,c){if("string"==typeof b&&1===arguments.length)return O[b]!==a?O[b]:n[b];var d="object"==typeof b&&1===arguments.length?b||{}:{};"string"==typeof b&&(d[b]=c);for(var e in d)d[e]!==a?O[e]=d[e]:delete O[e];return this}function G(){var a=["["+(ob||"domino")+"]"];F("strict")||a.push("WARNING");for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);F("strict")?d.apply(this,a):F("verbose")&&f.apply(this,a)}function H(){for(var a=["["+(ob||"domino")+"]"],b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);d.apply(this,a)}function I(){var a=["["+(ob||"domino")+"]"];if(F("verbose")){for(var b=0,c=arguments.length;c>b;b++)a.push(arguments[b]);f.apply(this,a)}}!function(){o.call(this);for(var a in o.prototype)this[a]=o.prototype[a]}.call(this);var J,K,L=this,M=k.utils,N=k.struct,O={},P={},Q={},R={},S={},T={},U={},V={},W={},X={},Y={},Z=[],$={},_={properties:{},shortcuts:{},services:{}},ab=0,bb={},cb={},db={},eb={},fb={},gb={},hb=[],ib={},jb={},kb={},lb={},mb={},nb={events:1,services:1,hacks:1};!function(){var a;for(a in Object.prototype)nb[a]=1;for(a in b({full:!0}))nb[a]=1}(),J=b({full:!0});var ob,pb={};return"string"===N.get(arguments[0])?(pb=arguments[1],pb.name=arguments[0]):arguments[0]!==a&&"object"===N.get(arguments[0])?pb=arguments[0]:arguments[1]!==a&&"object"===N.get(arguments[1])&&(pb=arguments[1]),pb.name=ob||pb.name,ob=pb.name,ob&&(i[ob]?H('An instance named "'+ob+'" is already running.'):i[ob]=J),function(){var a;if("array"===N.get(pb.properties))for(a in pb.properties)e(pb.properties[a].id,pb.properties[a]);else if("object"===N.get(pb.properties))for(a in pb.properties)e(a,pb.properties[a]);for(a in pb.hacks||[])h(pb.hacks[a]);if("array"===N.get(pb.services))for(a in pb.services)j(pb.services[a].id,pb.services[a]);else if("object"===N.get(pb.services))for(a in pb.services)j(a,pb.services[a]);if("array"===N.get(pb.shortcuts))for(a in pb.shortcuts)l(pb.shortcuts[a].id,pb.shortcuts[a]);else if("object"===N.get(pb.shortcuts))for(a in pb.shortcuts)l(a,pb.shortcuts[a])}(),K=M.clone(pb),J};k.version="1.3.1","undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports.domino=k):j.domino=k,k.utils={array:function(a,b){var c="string"===k.struct.get(a)?a.split(b||" "):"array"===k.struct.get(a)?a:[a],d=[];for(var e in c)c[e]&&d.push(c[e]);return d},clone:function(a){if(!a)return a;var b,c,d;if("array"===m.get(a))for(b=[],c=0,d=a.length;d>c;c++)b.push(this.clone(a[c]));else if("date"===m.get(a))b=new Date(a.getTime());else if("object"===m.get(a))if(a.nodeType&&"function"==typeof a.cloneNode)b=a;else if(a.prototype)b=a;else{b={};for(c in a)b[c]=this.clone(a[c])}else b=a;return b},partial:function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(this,b.concat(Array.prototype.slice.call(arguments)))}},ajax:function(a,c){b()||d('[domino.global] XMLHttpRequest not found. You can specify which XMLHttpRequest you want to use by using domino.settings("xhr", myXhr).'),"string"==typeof a?a={url:a,ok:c}:"object"!==m.get(a)&&d("[domino.global] Invalid parameter given to AJAX");var e,f,g,h=a.type||"GET",i=a.url||"",j=a.contentType||"application/x-www-form-urlencoded",k=a.dataType||"json",l=new n.xhr;if(a.data){if("string"==typeof a.data)f=a.data;else if(/json/.test(j))f=JSON.stringify(a.data);else{f=[];for(g in a.data)f.push(encodeURIComponent(g)+"="+encodeURIComponent(a.data[g]));f=f.join("&")}/GET|DEL/i.test(h)&&(i+=/\?/.test(i)?"&"+f:"?"+f,f="")}if(l.onreadystatechange=function(){if(4==l.readyState)if(e&&clearTimeout(e),/^2/.test(l.status)){if(f=l.responseText,/json/.test(k))try{f=JSON.parse(l.responseText)}catch(b){return a.error&&a.error("JSON parse error: "+b.message,l)}a.success&&a.success(f,l)}else{var c=+l.status?l.responseText:l.responseText.length?"Aborted: "+l.responseText:"Aborted";a.error&&a.error(c,l)}},l.open(h,i,!0),l.setRequestHeader("Content-Type",j),a.headers)for(g in a.headers)l.setRequestHeader(g,a.headers[g]);return"function"==typeof a.beforeSend&&a.beforeSend(l,a)===!1?l.abort():(a.timeout&&(e=setTimeout(function(){l.onreadystatechange=function(){},l.abort(),a.error&&a.error&&a.error("timeout",l)},1e3*a.timeout)),l.send(f),l)}},k.struct=function(){var b=["number","string","boolean","null","undefined"],e="Boolean Number String Function Array Date RegExp Object".split(" "),f={},g=["*"],h={};for(var i in e){var j=e[i];g.push(j.toLowerCase()),f["[object "+j+"]"]=j.toLowerCase()}return{add:function(b,c){var e,f,i,j,l,m;1===arguments.length?"object"===this.get(b)?(m=b,i=m.id,l=m.struct):d("[domino.global] If struct.add is called with one arguments, it has to be an object"):2===arguments.length?("string"===this.get(b)&&b?i=b:d("[domino.global] If struct.add is called with more than one arguments, the first one must be the string id"),l=c):d("[domino.global] struct.add has to be called with one or three arguments"),("string"!==this.get(i)||0===i.length)&&d("[domino.global] A structure requires an string id"),h[i]!==a&&"proto"!==h[i]&&d('[domino.global] The structure "'+i+'" already exists'),h[i]=1,f=k.utils.array((m||{}).proto),j={};for(e in f)h[f[e]]===a&&(h[f[e]]=1,j[f[e]]=1);if("function"===this.get(l)||this.isValid(l)||d('[domino.global] A structure requires a valid "structure" property describing the structure. It can be a valid structure or a function that test if an object matches the structure.'),~g.indexOf(i)&&d('[domino.global] "'+i+'" is a reserved structure name'),h[i]=m===a?{id:i,struct:l}:{},m!==a)for(e in m)h[i][e]=m[e];for(e in j)e!==i&&delete h[e]},get:function(a){return null==a?String(a):f[Object.prototype.toString.call(a)]||"object"},check:function(b,d,e){var f,i,j=this.get(d),k=e||{};if("string"===this.get(b)){f=b.replace(/^\?/,"").split(/\|/);for(i in f)if(g.indexOf(f[i])<0&&h[f[i]]===a)return c("[domino.global] Invalid type"),!1;if(null==d)return!!b.match(/^\?/,"");b=b.replace(/^\?/,"");for(i in f)if(h[f[i]]&&("function"===this.get(h[f[i]].struct)?h[f[i]].struct(d)===!0:this.check(h[f[i]].struct,d,h[f[i]])))return!0;return!(!~f.indexOf("*")&&!~f.indexOf(j))}if("object"===this.get(b)){if("object"!==j)return!1;var l;for(l in b)if(!this.check(b[l],d[l]))return!1;if(!k.includes)for(l in d)if(b[l]===a)return!1;return!0}if("array"===this.get(b)){if("array"!==j)return!1;if(1!==b.length)return c("[domino.global] Invalid type"),!1;for(l in d)if(!this.check(b[0],d[l]))return!1;return!0}return!1},deepScalar:function(a){var c,d;if("string"===this.get(a)){c=a.replace(/^\?/,"").split(/\|/);for(d in c)if(b.indexOf(c[d])<0)return!1;return!0}if(this.check("object|array",a)){for(d in a)if(!this.deepScalar(a[d]))return!1;return!0}return!1},compare:function(a,b,c){var d;if(this.get(a),this.get(b),!this.deepScalar(c)||!this.check(c,a)||!this.check(c,b))return!1;if("string"===this.get(c))return a===b;if("object"===this.get(c)){for(d in c)if(!this.compare(a[d],b[d],c[d]))return!1;return!0}if("array"===this.get(c)){if(a.length!==b.length)return!1;var e=a.length;for(d=0;e>d;d++)if(!this.compare(a[d],b[d],c[0]))return!1;return!0}return!1},isValid:function(b){var c,d,e;if("string"===this.get(b)){c=b.replace(/^\?/,"").split(/\|/);for(e in c)if(g.indexOf(c[e])<0&&h[c[e]]===a)return!1;return!0}if("object"===this.get(b)){for(d in b)if(!this.isValid(b[d]))return!1;return!0}return"array"===this.get(b)?1===b.length?this.isValid(b[0]):!1:!1}}}();var l=k.utils,m=k.struct,n={maxDepth:0,strict:!1,verbose:!1,displayTime:!1,shortcutPrefix:":",mergeRequests:!0,logDescriptions:!0,xhr:j.XMLHttpRequest,clone:!1};k.settings=function(b,c){if("string"==typeof b&&1===arguments.length)return n[b];var d="object"==typeof b&&1===arguments.length?b||{}:{};"string"==typeof b&&(d[b]=c);for(var e in d)d[e]!==a?n[e]=d[e]:delete n[e];return this},k.instances=function(a){return arguments.length?i[a]:(d("[domino.global] You need to indicate a name to get the instance."),void 0)},k.EventDispatcher=function(){Object.defineProperty(this,"_handlers",{value:{}})};var o=k.EventDispatcher;o.prototype.addEventListener=function(a,b){if(!arguments.length)return this;if(1===arguments.length&&"object"===l.type.get(arguments[0]))for(var a in arguments[0])this.addEventListener(a,arguments[0][a]);else if(arguments.length>1){var c,a=arguments[0],b=arguments[1],d=l.array(a);for(var e in d)c=d[e],this._handlers[c]||(this._handlers[c]=[]),this._handlers[c].push({handler:b})}return this},o.prototype.removeEventListener=function(a,b){var c,d,e,f,g=l.array(a);if(!arguments.length){for(c in this._handlers)delete this._handlers[c];return this}if(b)for(c in g){if(f=g[c],this._handlers[f]){e=[];for(d in this._handlers[f])this._handlers[f][d].handler!==b&&e.push(this._handlers[f][d]);this._handlers[f]=e}this._handlers[f]&&0===this._handlers[f].length&&delete this._handlers[f]}else for(c in g)delete this._handlers[g[c]];return this},o.prototype.dispatchEvent=function(b,c){var d,e,f,g,h,i=l.array(b),j=this;c=c===a?{}:c;for(d in i)if(h=i[d],this._handlers[h]){g=j.getEvent(h,c),f=[];for(e in this._handlers[h])this._handlers[h][e].handler(g),this._handlers[h][e].one||f.push(this._handlers[h][e]);this._handlers[h]=f}return this},o.prototype.getEvent=function(a,b){return{type:a,data:b||{},target:this}},k.module=function(){o.call(this);for(var a in o.prototype)this[a]=o.prototype[a];this.triggers={properties:{},events:{}},this.log=this.warn=this.die=function(){}}}.call(this);